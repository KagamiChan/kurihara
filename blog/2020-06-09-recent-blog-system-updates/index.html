<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.7"/><meta data-react-helmet="true" name="description" content="明镜止水的个人日志"/><meta data-react-helmet="true" name="keywords" content="明镜止水, HP, BLOG"/><style data-href="/styles.b3622f1573c9b5a13a23.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><title data-react-helmet="true">少年读书隙中窥月::最近日志系统的一些小更新</title><link data-react-helmet="true" rel="preconnect" href="https://fonts.gstatic.com"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC&amp;display=swap" rel="stylesheet"/><style data-styled="" data-styled-version="5.3.11">.dTUXhO h1,.dTUXhO h2,.dTUXhO h3,.dTUXhO h4,.dTUXhO h5,.dTUXhO h6{margin-bottom:1rem;font-weight:500;line-height:1.625;}/*!sc*/
.dTUXhO h1{font-size:2.25rem;line-height:2.5rem;}/*!sc*/
.dTUXhO h2{font-size:1.875rem;line-height:2.25rem;}/*!sc*/
.dTUXhO h3{font-size:1.5rem;line-height:2rem;}/*!sc*/
.dTUXhO h4{font-size:1.25rem;line-height:1.75rem;}/*!sc*/
.dTUXhO h5{font-size:1.125rem;line-height:1.75rem;}/*!sc*/
.dTUXhO a:not(.gatsby-resp-image-link){--tw-text-opacity:1;color:rgb(14 165 233 / var(--tw-text-opacity));-webkit-transition-duration:100ms;transition-duration:100ms;}/*!sc*/
.dTUXhO a:not(.gatsby-resp-image-link):hover{--tw-bg-opacity:1;background-color:rgb(224 242 254 / var(--tw-bg-opacity));}/*!sc*/
.dTUXhO p{margin-bottom:1rem;line-height:1.625;}/*!sc*/
.dTUXhO ol{list-style-position:inside;list-style-type:decimal;}/*!sc*/
.dTUXhO ul{list-style-position:inside;list-style-type:disc;}/*!sc*/
.dTUXhO li{margin-bottom:0.5rem;}/*!sc*/
.dTUXhO hr{margin-bottom:1rem;}/*!sc*/
data-styled.g2[id="common__Content-sc-1yarisu-1"]{content:"dTUXhO,"}/*!sc*/
.hQcpJz{margin-bottom:1rem;font-size:3.75rem;line-height:1.625;font-weight:500;}/*!sc*/
data-styled.g3[id="common__Title-sc-1yarisu-2"]{content:"hQcpJz,"}/*!sc*/
.khYSRG{margin-bottom:1rem;margin-top:1rem;}/*!sc*/
.khYSRG a{--tw-text-opacity:1;color:rgb(14 165 233 / var(--tw-text-opacity));-webkit-transition-duration:100ms;transition-duration:100ms;}/*!sc*/
.khYSRG a:hover{--tw-bg-opacity:1;background-color:rgb(224 242 254 / var(--tw-bg-opacity));}/*!sc*/
data-styled.g4[id="common__FooterWrapper-sc-1yarisu-3"]{content:"khYSRG,"}/*!sc*/
.iTqeTn{margin-bottom:0px;}/*!sc*/
data-styled.g5[id="meta__Wrapper-sc-14h9idm-0"]{content:"iTqeTn,"}/*!sc*/
.fJgfse{position:absolute;left:0px;top:2rem;}/*!sc*/
data-styled.g6[id="shortcut__Sentinel-sc-izktlo-0"]{content:"fJgfse,"}/*!sc*/
.dlTWzz{position:fixed;bottom:1rem;left:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:2rem;width:2rem;cursor:pointer;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:9999px;--tw-bg-opacity:1;background-color:rgb(14 165 233 / var(--tw-bg-opacity));font-size:1.25rem;line-height:1.75rem;--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity));opacity:0.75;-webkit-transition-duration:100ms;transition-duration:100ms;opacity:0;}/*!sc*/
.dlTWzz:hover{opacity:1;}/*!sc*/
data-styled.g7[id="shortcut__Button-sc-izktlo-1"]{content:"dlTWzz,"}/*!sc*/
*,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb;--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x:var(--tw-empty,/*!*/ /*!*/);--tw-pan-y:var(--tw-empty,/*!*/ /*!*/);--tw-pinch-zoom:var(--tw-empty,/*!*/ /*!*/);--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position:var(--tw-empty,/*!*/ /*!*/);--tw-gradient-via-position:var(--tw-empty,/*!*/ /*!*/);--tw-gradient-to-position:var(--tw-empty,/*!*/ /*!*/);--tw-ordinal:var(--tw-empty,/*!*/ /*!*/);--tw-slashed-zero:var(--tw-empty,/*!*/ /*!*/);--tw-numeric-figure:var(--tw-empty,/*!*/ /*!*/);--tw-numeric-spacing:var(--tw-empty,/*!*/ /*!*/);--tw-numeric-fraction:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(14 165 233 / 0.5);--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-blur:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-invert:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-opacity:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-contain-size:var(--tw-empty,/*!*/ /*!*/);--tw-contain-layout:var(--tw-empty,/*!*/ /*!*/);--tw-contain-paint:var(--tw-empty,/*!*/ /*!*/);--tw-contain-style:var(--tw-empty,/*!*/ /*!*/);}/*!sc*/
::before,::after{--tw-content:'';}/*!sc*/
html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif;font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent;}/*!sc*/
body{margin:0;line-height:inherit;}/*!sc*/
hr{height:0;color:inherit;border-top-width:1px;}/*!sc*/
abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}/*!sc*/
h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}/*!sc*/
a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}/*!sc*/
b,strong{font-weight:bolder;}/*!sc*/
code,kbd,samp,pre{font-family:ui-monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em;}/*!sc*/
small{font-size:80%;}/*!sc*/
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}/*!sc*/
sub{bottom:-0.25em;}/*!sc*/
sup{top:-0.5em;}/*!sc*/
table{text-indent:0;border-color:inherit;border-collapse:collapse;}/*!sc*/
button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;-webkit-letter-spacing:inherit;-moz-letter-spacing:inherit;-ms-letter-spacing:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0;}/*!sc*/
button,select{text-transform:none;}/*!sc*/
button,input:where([type='button']),input:where([type='reset']),input:where([type='submit']){-webkit-appearance:button;background-color:transparent;background-image:none;}/*!sc*/
:-moz-focusring{outline:auto;}/*!sc*/
:-moz-ui-invalid{box-shadow:none;}/*!sc*/
progress{vertical-align:baseline;}/*!sc*/
::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto;}/*!sc*/
[type='search']{-webkit-appearance:textfield;outline-offset:-2px;}/*!sc*/
::-webkit-search-decoration{-webkit-appearance:none;}/*!sc*/
::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}/*!sc*/
summary{display:list-item;}/*!sc*/
blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}/*!sc*/
fieldset{margin:0;padding:0;}/*!sc*/
legend{padding:0;}/*!sc*/
ol,ul,menu{list-style:none;margin:0;padding:0;}/*!sc*/
dialog{padding:0;}/*!sc*/
textarea{resize:vertical;}/*!sc*/
input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{opacity:1;color:#9ca3af;}/*!sc*/
input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af;}/*!sc*/
input:-ms-input-placeholder,textarea:-ms-input-placeholder{opacity:1;color:#9ca3af;}/*!sc*/
input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af;}/*!sc*/
button,[role="button"]{cursor:pointer;}/*!sc*/
:disabled{cursor:default;}/*!sc*/
img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}/*!sc*/
img,video{max-width:100%;height:auto;}/*!sc*/
[hidden]{display:none;}/*!sc*/
::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x:var(--tw-empty,/*!*/ /*!*/);--tw-pan-y:var(--tw-empty,/*!*/ /*!*/);--tw-pinch-zoom:var(--tw-empty,/*!*/ /*!*/);--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position:var(--tw-empty,/*!*/ /*!*/);--tw-gradient-via-position:var(--tw-empty,/*!*/ /*!*/);--tw-gradient-to-position:var(--tw-empty,/*!*/ /*!*/);--tw-ordinal:var(--tw-empty,/*!*/ /*!*/);--tw-slashed-zero:var(--tw-empty,/*!*/ /*!*/);--tw-numeric-figure:var(--tw-empty,/*!*/ /*!*/);--tw-numeric-spacing:var(--tw-empty,/*!*/ /*!*/);--tw-numeric-fraction:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(14 165 233 / 0.5);--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-blur:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-invert:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-opacity:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-backdrop-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-contain-size:var(--tw-empty,/*!*/ /*!*/);--tw-contain-layout:var(--tw-empty,/*!*/ /*!*/);--tw-contain-paint:var(--tw-empty,/*!*/ /*!*/);--tw-contain-style:var(--tw-empty,/*!*/ /*!*/);}/*!sc*/
data-styled.g8[id="sc-global-bUNtRb1"]{content:"sc-global-bUNtRb1,"}/*!sc*/
*:focus{outline-style:dashed;outline-width:2px;}/*!sc*/
html{font-family:Noto Serif SC,Times,Times New Roman,STSong,SimSun,serif,system-ui;font-size:20px;}/*!sc*/
data-styled.g9[id="sc-global-bELNLL1"]{content:"sc-global-bELNLL1,"}/*!sc*/
.lhiUTn{position:-webkit-sticky;position:sticky;top:0px;z-index:10;--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity));}/*!sc*/
data-styled.g10[id="base-layout__HeaderWrap-sc-1n2bebh-0"]{content:"lhiUTn,"}/*!sc*/
.NRWiJ{margin-left:0px;max-width:960px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
@media (min-width:768px){.NRWiJ{margin-left:3rem;}}/*!sc*/
data-styled.g11[id="base-layout__Header-sc-1n2bebh-1"]{content:"NRWiJ,"}/*!sc*/
.byUIMs{margin:0;display:block;}/*!sc*/
data-styled.g12[id="base-layout__H1-sc-1n2bebh-2"]{content:"byUIMs,"}/*!sc*/
.gRlvJT{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:4rem;width:8rem;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;overflow:hidden;background-size:contain;background-repeat:no-repeat;--tw-text-opacity:1;color:rgb(14 165 233 / var(--tw-text-opacity));}/*!sc*/
data-styled.g13[id="base-layout__H1Link-sc-1n2bebh-3"]{content:"gRlvJT,"}/*!sc*/
.gKyBTF{margin-left:1rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
data-styled.g14[id="base-layout__Nav-sc-1n2bebh-4"]{content:"gKyBTF,"}/*!sc*/
.gRLgLT{position:relative;padding-left:0.5rem;padding-right:0.5rem;font-size:1.25rem;line-height:1.75rem;}/*!sc*/
.gRLgLT:hover{--tw-text-opacity:1;color:rgb(14 165 233 / var(--tw-text-opacity));}/*!sc*/
.gRLgLT:hover:before{position:absolute;bottom:0px;left:0px;display:block;height:1px;width:100%;--tw-bg-opacity:1;background-color:rgb(56 189 248 / var(--tw-bg-opacity));content:'';}/*!sc*/
data-styled.g15[id="base-layout__NavItem-sc-1n2bebh-5"]{content:"gRLgLT,"}/*!sc*/
.jxLQiO{margin-left:0px;margin-top:1rem;max-width:72rem;}/*!sc*/
@media (min-width:768px){.jxLQiO{margin-left:3rem;}}/*!sc*/
data-styled.g16[id="base-layout__Content-sc-1n2bebh-6"]{content:"jxLQiO,"}/*!sc*/
.lbKRzM{margin-bottom:2rem;margin-top:8rem;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}/*!sc*/
data-styled.g22[id="hitokoto__Wrapper-sc-19e4vqn-0"]{content:"lbKRzM,"}/*!sc*/
.jJzWMG{--tw-bg-opacity:1;background-color:rgb(243 244 246 / var(--tw-bg-opacity));padding:1rem;font-size:0.875rem;line-height:1.25rem;}/*!sc*/
data-styled.g23[id="hitokoto__Container-sc-19e4vqn-1"]{content:"jJzWMG,"}/*!sc*/
.bKYWTD{white-space:pre-wrap;}/*!sc*/
data-styled.g24[id="hitokoto__Content-sc-19e4vqn-2"]{content:"bKYWTD,"}/*!sc*/
.gqGogU{margin-left:4rem;text-align:right;}/*!sc*/
data-styled.g25[id="hitokoto__Footer-sc-19e4vqn-3"]{content:"gqGogU,"}/*!sc*/
.ezfyNh{margin-bottom:1rem;font-size:1.125rem;line-height:1.75rem;--tw-text-opacity:1;color:rgb(107 114 128 / var(--tw-text-opacity));}/*!sc*/
data-styled.g27[id="blog-post__Timestamp-sc-1yiduhu-0"]{content:"ezfyNh,"}/*!sc*/
.kVmMLS{--tw-text-opacity:1;color:rgb(249 115 22 / var(--tw-text-opacity));}/*!sc*/
data-styled.g28[id="blog-post__Notice-sc-1yiduhu-1"]{content:"kVmMLS,"}/*!sc*/
</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="base-layout__HeaderWrap-sc-1n2bebh-0 lhiUTn"><div class="base-layout__Header-sc-1n2bebh-1 NRWiJ"><h1 id="blog-title" class="base-layout__H1-sc-1n2bebh-2 byUIMs"><a class="base-layout__H1Link-sc-1n2bebh-3 gRlvJT" href="/blog/"><svg viewBox="0 0 52.917 19.05" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="少年读书隙中窥月"><path fill="currentcolor" d="M0 0v19.05h3.303v-7.1l1.728.642h.42l.804-.787 1.524 1.392c-.084.12-.252.169-.54.18-.42.75-1.152 1.985-1.8 2.771 1.155.726 1.73 1.913 1.783 2.902h.341v-4.1c-.252.158-.516.29-.792.412l-.096-.121c.66-.81 1.2-2.093 1.416-2.952l1.656.883V11.77l2.005.157c-.024.17-.108.29-.444.351v3.024h.492l.731-.834 1.38 1.04c-.071.109-.191.193-.467.242v3.266c0 .008-.01.02-.028.035h2.056v-5.418l1.968.75h2.124V11.66l2.304.218c-.024.17-.108.302-.444.35v2.154h2.172l.792-.883 1.644 1.258c-.072.097-.216.218-.468.266v3.895c-.003.03-.095.078-.229.132h1.695l-.062-.216h1.572c.024-.267.024-.545.024-.811v-.726h-1.296l-.096-.339h1.392V15.58c-.504.133-1.02.255-1.512.351l-.072-.133c1.044-.472 2.749-1.645 3.589-2.322h-2.137c.132.822-.131 1.403-.563 1.608-.42.218-.985.049-1.129-.46-.12-.507.192-.846.612-1.027.313-.206.636-.69.54-1.21l.156-.012c.132.266.24.52.3.762h3.66a1.922 1.922 0 0 0-.78-1.367l.073-.073c.298-.046.562-.067.793-.066 1.619.005 1.66 1.061 1.103 1.506h2.868l.828-.847 1.452 1.38c-.096.096-.204.132-.456.156a9.801 9.801 0 0 1-1.116.666c.684.58.588 1.294.012 1.403l.36.278c-.048.073-.156.145-.324.182v2.696h4.208c.118-.79.148-1.608.148-2.442v-4.476l2.028.677h3.049l.792-.907 1.596 1.27c-.072.097-.216.206-.468.254v5.624h4.743V0H47.95l-.173 2.285.853-.798 1.488 1.246c-.096.109-.228.193-.48.23-.108 2.395-.312 3.447-.948 3.895-.396.29-.876.435-1.716.435.012-.508-.036-.919-.252-1.161-.228-.254-.624-.46-1.176-.58l.011-.122c.492.037 1.284.073 1.524.073.18 0 .265-.024.349-.097.228-.193.348-1.113.42-2.746h-3.06v4.67c0 .18-.817.653-1.513.653h-.36V2.66H39.21l-.108-.339h3.816V0h-5.115l.651.616c-.096.109-.216.145-.468.157-.432.508-1.176 1.198-1.776 1.597l-.096-.073c.108-.52.216-1.282.276-1.85h-5.952l-.097-.34h2.689V0h-2.955l.23.193c-.06.084-.204.18-.516.217v4.827c.384-.145.78-.303 1.176-.46l.036.097c-.324.46-.996 1.33-1.884 2.274a1.272 1.272 0 0 1-.42.593l-1.212-1.766c.612-.363.708-.496.708-.774V.144h-1.32L26.826 0H22.42v1.293h.684L23.992.18s1.008.75 1.62 1.258c-.036.134-.168.194-.348.194H22.42v3.012h1.116l.948-1.197s1.068.798 1.728 1.342c-.036.133-.18.194-.36.194H22.42v2.54c-.012.109-.564.484-1.548.484h-.36V4.983h-5.604l-.096-.339h2.016V.652c-.6.496-1.236.895-1.908 1.246l-.108-.097c.402-.49.824-1.108 1.227-1.801h-2.562c1.254 1.405.266 2.958-1.006 2.092C12.27 1.4 11.905.673 11.48 0H9.495v3.374c0 .266-.9.92-1.584.92h-.216V0h-1.26c-.76 1.4-1.907 2.963-3.54 3.99l-.096-.096C3.595 2.81 4.217 1.342 4.626 0Zm17.566 0c-.212.209-.43.406-.654.592l1.932.701h1.668V0Zm17.07 0v.108h1.645L36.388 0ZM44.79 0v2.321h1.249L46.215 0ZM33.653.604l2.256.302c-.036.133-.12.218-.456.23-.144 1.222-.372 2.262-.744 3.133h1.224l.816-1.076s.936.725 1.488 1.221c-.024.133-.156.194-.336.194h-3.348c-.852 1.778-2.376 2.83-5.076 3.435l-.048-.12c1.86-.69 3-1.779 3.612-3.315h-2.82l-.096-.339h3.048c.348-1.028.492-2.238.48-3.665zm-1.718.195c2.15.06 1.417 2.093.218 1.51-.156-.52-.612-1.088-1.044-1.379l.084-.084a4.9 4.9 0 0 1 .742-.047zm-13.259.833v3.012h1.836V1.632Zm-7.776.17 2.124 1.076c-.096.145-.265.193-.577.157-2.352 3.738-5.196 4.682-9.156 4.996l-.036-.157c3.3-.907 6.06-2.262 7.645-6.073Zm20.33.65c2.427.014 1.632 2.186.395 1.55-.132-.543-.588-1.136-1.008-1.439l.084-.084a4.86 4.86 0 0 1 .529-.028zm3.383 2.543c4.452.532 3.636 3.653 2.016 2.818-.432-.943-1.356-2.032-2.112-2.734Zm-23.042 7.39c3.66.449 2.677 3.146 1.273 2.311-.24-.774-.864-1.657-1.368-2.237zm-6.708.545v6.12h.83c.022-.092.034-.203.034-.338 0-.822-.144-1.778-.6-2.528.168-.822.372-2.286.444-3.254zm38.078.218v2.347h3.433v-2.347zm-33.194.218c-.072.036-.18.048-.336.036-.396.46-.936.956-1.572 1.38l1.368.52h.54zm21.266.109 1.332.955c-.096.145-.312.206-.708.158-.636.241-1.572.568-2.557.846l1.32.133c-.023.158-.12.279-.408.315v1.004l.565-.798s.696.604 1.104 1.016c-.036.133-.156.193-.312.193h-1.357v.738c0 .266-.011.532-.047.799h.024l.66-.944s.744.653 1.176 1.089a.244.244 0 0 1-.033.07h.08v-3.748l1.44.58h2.04l.505-.531c-.852-.617-2.064-1.186-3.024-1.452l.072-.157c1.476-.145 2.532.036 3.228.339.024-.206.048-.412.06-.605zM17.308 14.72v3.254h2.256V14.72zm4.116 0v3.254h2.28V14.72Zm-12.337.919v1.222h2.76V15.64zm33.854.193v.763c0 .556-.012 1.112-.084 1.681h3.517v-2.444zm-9.708.388v2.829h.375c.09-.75.085-1.569.093-2.466l1.692.145c-.024.169-.132.29-.396.326a23.995 23.995 0 0 1-.108 1.706l.54.048v-2.588Zm-24.146.98v1.282h2.76V17.2zm8.22 1.112v.63c0 .03-.024.067-.065.107h2.322v-.737zm4.117 0v.737h2.28v-.737zm21.385.303a7.35 7.35 0 0 1-.083.434h3.648v-.434Zm-33.722.205v.229h.624v-.229zm2.184 0v.229h.576v-.229zm24.158.194a.411.411 0 0 1-.052.035h.052z"></path></svg></a></h1><nav class="base-layout__Nav-sc-1n2bebh-4 gKyBTF"><a class="base-layout__NavItem-sc-1n2bebh-5 gRLgLT" href="/archieves/">存档</a><a aria-current="page" class="base-layout__NavItem-sc-1n2bebh-5 gRLgLT" href="/blog/2020-06-09-recent-blog-system-updates/">列表</a><a class="base-layout__NavItem-sc-1n2bebh-5 gRLgLT" href="/about/">关于</a></nav></div></div><div class="base-layout__Content-sc-1n2bebh-6 jxLQiO"><article class="common__Article-sc-1yarisu-0 gArEsl"><h1 id="post-title" class="common__Title-sc-1yarisu-2 hQcpJz">最近日志系统的一些小更新</h1><div class="common__Content-sc-1yarisu-1 dTUXhO"><div class="blog-post__Timestamp-sc-1yiduhu-0 ezfyNh">发布于<time dateTime="2020-06-09T01:57:07.613+08:00">2020-06-08</time><div class="blog-post__Notice-sc-1yiduhu-1 kVmMLS">这篇文章还是草稿</div></div><div><p>尽管从去年至今，一直因为各种原因没有写新的文字。不过我还是陆陆续续地把以前的文章迁移过来了，尽管大部分都是很无聊也没什么意义的内容，但是实在没有时间一点一点地审阅。同时其实整个系统也是有各个方面的小更新的。大概记录一下看看有没有助于后人避坑吧。</p>
<h2>自动升级与测试</h2>
<p>Gatsby 是以 monorepo 的形式开发的。这种形式的好处是组合比较灵活自由，但是坏处就是包的数量非常多。之前都是手动升级的，但是有一次隔了大约几个月的升级，因为兼容性问题，折腾了很久。加上 <code class="language-text">dependabot</code> 这样的自动升级机器人已经变得较为成熟了，我觉得实现小周期的定时升级，可以有助于问题的定位。所以决定也部署一个。</p>
<p>但是比较尴尬的是，之前我在写代码的时候是没有配套单元测试的，实在是因为纯个人项目，并且心中的想法也没有最终的定稿。虽然靠 linter 和 build 已经能解决不少很初级的回归，但是还是感觉有测试会更轻松一点。因为工作过程中见识到了图像差分测试，所以就想给项目也来一个，至少能保证自动升级前后大体上页面没有变化。</p>
<p>差分测试的思路是比较清晰的，用<code class="language-text">serve</code>来起一个静态服务器，通过<code class="language-text">jest-puppeteer</code>来驱动<code class="language-text">chromium</code>跑 E2E test，在需要截图的地方截个图，再和 repo 里面的现有参考截图比较。不过实际操作中发现两个小坑，</p>
<ul>
<li>随机变量的影响。我的页面是有一些随机元素的，比如首页的背景是随机生成的，还有日志中的“一言”部分。为了控制这些影响，就只能用变量来控制随机性，这个可以在编译的时候专门加一个环境变量，也可以检测<code class="language-text">query params</code>，不过就是需要多写不少代码</li>
<li>机器环境的影响。我本地是在 macOS 下生成参考截图的。然而 ci 机器上面跑的是 Linux，第一没有安装中文字体，第二就是 chromium 的渲染结果总有细微的差别，比如文字渲染和（阴影）渐变。前者可以手动安装字体，后面这个就只能用 ci 机器上的图作为参考图了，为此又专门加了一个发布的任务。然而这回又轮到在我本地更新参考截图变得有点困难了</li>
</ul>
<p>于是最后也只能放弃了做图像差分的方案，简单地保留了 e2e 的部分。之后应该会逐渐地加一些单元测试。</p>
<h2>Github Actions</h2>
<p>之前日志的测试和部署是平行的，在 circleci 上跑编译和测试，而 netlify 上面做的部署的时候也是需要编译一遍。随着自动更新的启用，netlify 的编译频次显著地增加了。因为 <code class="language-text">dependabot</code> 以包为粒度发布 PR 的，而我又开启了 PR 预览，所以一个包的更新会的 netlify 上走两次编译。不巧地是 gatsby 的包又巨多无比，每个月都要花几百分钟的机器时间（项目克隆 + 缓存下载 + 编译 + 优化 + 部署的总时间），而且我的 netlify 用户下面还有其它项目。种种因素，导致 netlify 开启免费计划的机器时间限额的第一个月，我吃到了 7 美元的账单。这显然是不划算的，因为一个放静态内容 VPS 的月租撑死了也就 5 刀。</p>
<p>虽然我也考虑过把 netlify 换掉，用类似的其它方案。但是 netlify 本身的其它地方做得还是可以的，就只有编译时间限额这一点显得比较黑——把克隆和下载之类的不占资源的垃圾时间也算进去了。最后决定首先是关掉 PR 预览，其次是把编译移走，换到 CI 机器上去做。正好当时 Github Actions 开放使用了，就顺便切换到了 Github Actions。</p>
<p>改进后的流程是 Github Actions 编译，测试，把结果部署到 release 分支上，然后 release 分支触发 netlify 的部署。这样下来每个月终于能保证在额度内了。</p>
<h2>TypeScript</h2>
<p>Gatsby 本身是没有原生 TypeScript 支持的。虽然借助<code class="language-text">babel-preset-typescript</code>，编译不成问题，但是难点主要在 GraphQL 数据的 typing 上。所以我就一直不想动。不过今年年初，<a href="https://www.gatsbyjs.org/blog/2020-01-23-why-typescript-chose-gatsby/">TypeScript 团队宣布使用 Gatsby 来搭建新版本网站</a>，这让我觉得也许是时候了。</p>
<p>GraphQL 的 typing 之前已经有轮子了，至少据我了解我前司的同事们已经顺利调教过了——虽然直到跑路也没什么机会了解他们在架构上怎么设计的。总而言之，就是同一个 codegen 轮子，根据 GraphQL 的 schema，生成一堆正常人写不出来的 typing，然后在代码里面引入这些 types，就能顺利地让自己的组件变得科学起来。具体细节上还有一些值得推敲的地方：</p>
<h3>要不要提交这个 typing</h3>
<p>这个 typing 比较大，又像是编译产物，TypeScript 团队的那一位作者是不赞成的。不过我最后还是决定提交了，因为下文的其它选择的限制。这个文件提交之后，我发现它是经常变的，开发和编译时候的一些变量会有增减，而且随着升级，也有可能引入新的一些变量——尽管这都不会有什么大影响。我又是一个喜欢在 VS Code 里面点个大加号全都提交的，所以总有误提交的时候，创造了不必要的提交历史。我也想过是不是应该忽略掉这个文件的改动，但是实际操作起来感觉有点麻烦，并且万一真的有需要做提交，也是一样有点麻烦，所以就暂时随缘提交了。</p>
<h3>Gatsby 的配置要不要改成 TypeScript</h3>
<p>这个具体就是 <code class="language-text">gatsby-node.js</code>/<code class="language-text">gatsby-ssr.js</code>/<code class="language-text">gatsby-config.js</code> 之类的。因为配置里面有很多读 GraphQL 数据的地方，用 ts 的确有助于保证正确性。于是我就还试着把最大的一块 <code class="language-text">gatsby-node.js</code> 改成了 ts。技术上也很直观，用 <code class="language-text">babel</code> 或者 <code class="language-text">ts-node</code> 来注册一下转译。不过做完之后才发现，我陷入了一个鸡蛋问题。需要有 typing，于是要先跑<code class="language-text">gatsby build</code>，但是<code class="language-text">gatsby build</code>需要有 typing 才能跑起来。当然其实可以只去 type 跑，不管是<code class="language-text">babel</code>或者<code class="language-text">ts-node</code>都能办到（<code class="language-text">ts-node</code>我是后来才知道的），不过我最终还是选择了提交 typing 来避免自己陷入这种奇怪的情况。</p>
<h2>Tailwind</h2>
<p>未完待续</p></div></div></article><div class="common__FooterWrapper-sc-1yarisu-3 hitokoto__Wrapper-sc-19e4vqn-0 khYSRG lbKRzM"><div class="hitokoto__Container-sc-19e4vqn-1 jJzWMG"><div class="hitokoto__Content-sc-19e4vqn-2 bKYWTD">古い星の光 僕たちを照らします
世界中 何も無かった それ以外は
</div><div class="hitokoto__Footer-sc-19e4vqn-3 gqGogU">—— <!-- -->草野正宗 / スピッツ<!-- --> - <span class="hitokoto__Source-sc-19e4vqn-4 ezquKY">スピカ</span> <a href="https://www.youtube.com/watch?v=skTm1_kwR8w" target="_blank" rel="noreferrer"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="up-right-from-square" class="svg-inline--fa fa-up-right-from-square " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M352 0c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9L370.7 96 201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L416 141.3l41.4 41.4c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V32c0-17.7-14.3-32-32-32H352zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"></path></svg></a></div></div></div><div class="common__FooterWrapper-sc-1yarisu-3 meta__Wrapper-sc-14h9idm-0 khYSRG iTqeTn"><div>自豪地基于 <a href="https://reactjs.org">React.js</a> 与<!-- --> <a href="https://gatsbyjs.org">Gatsby.js</a> 驱动 |<!-- --> <a href="/rss.xml">RSS 订阅可用</a></div><div>内容基于<!-- --> <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC-BY-SA 4.0</a> <!-- -->授权 | 评点或斧正可以<!-- --> <a href="https://github.com/KagamiChan/kurihara/issues/new"> <!-- -->在此提交 issue<!-- --> </a></div><div>2013-<!-- -->2024<!-- --> 鏡 ＠ がんばらないプロジェクト / 夜ノ森工房</div></div></div><div class="shortcut__Sentinel-sc-izktlo-0 fJgfse"></div><a title="回到顶部" class="shortcut__Button-sc-izktlo-1 dlTWzz"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-up" class="svg-inline--fa fa-arrow-up " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"></path></svg></a></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-128304723-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2020-06-09-recent-blog-system-updates/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-a7b2fb79d75a676f707e.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-f2f5049b87f3b12706b9.js\"],\"component---src-pages-archieves-tsx\":[\"/component---src-pages-archieves-tsx-6a028fd067719b2059d5.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-0af956c8c4b828a8aaa4.js\"],\"component---src-templates-blog-post-tsx\":[\"/component---src-templates-blog-post-tsx-12ee9d69d5eef79427d8.js\"],\"component---src-templates-page-tsx\":[\"/component---src-templates-page-tsx-dddeddb32a371e9a47f1.js\"],\"component---src-templates-paginated-blog-index-tsx\":[\"/component---src-templates-paginated-blog-index-tsx-a6b90d0bcde48db18d14.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="5c6b5b4ba9e476dd71bf";</script><script src="/webpack-runtime-a9863ff1493568edd83a.js" async></script><script src="/app-a7b2fb79d75a676f707e.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>